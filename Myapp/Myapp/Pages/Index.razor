@page "/"
@attribute [Authorize]
@inject NavigationManager NavigationManager

<div class="app-container">
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Gestão Ativos</h2>
        </div>
        <nav class="sidebar-nav">
            <a href="/" class="nav-item active">
                <div class="nav-icon dashboard-nav-icon"></div>
                <span>Dashboard</span>
            </a>
            <a href="/portfolio" class="nav-item">
                <div class="nav-icon portfolio-nav-icon"></div>
                <span>Carteira</span>
            </a>
            <a href="/transactions" class="nav-item">
                <div class="nav-icon transactions-nav-icon"></div>
                <span>Transações</span>
            </a>
            <a href="/reports" class="nav-item">
                <div class="nav-icon reports-nav-icon"></div>
                <span>Relatórios</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <a href="javascript:void(0)" @onclick="Logout" class="nav-item logout">
                <div class="nav-icon logout-nav-icon"></div>
                <span>Sair</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Header -->
        <header class="dashboard-header">
            <div class="dashboard-title">
                <h1>Dashboard Financeiro</h1>
                <p>Visão geral dos seus ativos financeiros</p>
            </div>
            <div class="user-profile">
                <span class="user-greeting">Olá, <strong>@userName</strong></span>
                <button class="user-menu-button" @onclick="ToggleUserMenu">
                    <div class="avatar">@userInitials</div>
                    @if (showUserMenu)
                    {
                        <div class="user-menu">
                            <a href="/profile" class="user-menu-item">Meu Perfil</a>
                            <a href="javascript:void(0)" @onclick="Logout" class="user-menu-item logout">Sair</a>
                        </div>
                    }
                </button>
            </div>
        </header>

        <!-- Portfolio Summary -->
        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-icon portfolio-icon"></div>
                <div class="stat-info">
                    <span class="stat-value">325.800,00 €</span>
                    <span class="stat-label">Valor Total da Carteira</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon performance-icon"></div>
                <div class="stat-info">
                    <span class="stat-value">+5,2%</span>
                    <span class="stat-label">Retorno Mensal</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon dividends-icon"></div>
                <div class="stat-info">
                    <span class="stat-value">1.520,00 €</span>
                    <span class="stat-label">Rendimentos do Mês</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon alerts-icon"></div>
                <div class="stat-info">
                    <span class="stat-value">2</span>
                    <span class="stat-label">Alertas Ativos</span>
                </div>
            </div>
        </div>

        <!-- Asset Allocation -->
        <div class="dashboard-content">
            <div class="dashboard-section">
                <div class="section-header">
                    <h2>Alocação de Ativos</h2>
                    <a href="/portfolio" class="view-all">Ver detalhes</a>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Classe</th>
                                <th>Valor</th>
                                <th>Alocação</th>
                                <th>Alvo</th>
                                <th>Retorno</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var asset in assetAllocation)
                            {
                                <tr>
                                    <td>@asset.Class</td>
                                    <td>@asset.Value.ToString("C2")</td>
                                    <td>@asset.Allocation.ToString("0.0")%</td>
                                    <td>@asset.Target.ToString("0.0")%</td>
                                    <td class="@(asset.Return >= 0 ? "positive-return" : "negative-return")">@(asset.Return >= 0 ? "+" : "")@asset.Return.ToString("0.0")%</td>
                                    <td><span class="status-badge @asset.StatusClass">@asset.Status</span></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="dashboard-row">
                <div class="dashboard-section half">
                    <div class="section-header">
                        <h2>Próximos Pagamentos</h2>
                        <a href="/payments" class="view-all">Ver todos</a>
                    </div>
                    <div class="maintenance-list">
                        @foreach (var payment in upcomingPayments)
                        {
                            <div class="maintenance-item">
                                <div class="maintenance-date">
                                    <span class="day">@payment.Date.Day</span>
                                    <span class="month">@payment.Date.ToString("MMM")</span>
                                </div>
                                <div class="maintenance-details">
                                    <h4>@payment.AssetName</h4>
                                    <p>@payment.Value.ToString("C2") (@payment.Description)</p>
                                    <span class="maintenance-technician">@payment.Type</span>
                                </div>
                            </div>
                        }
                    </div>
                </div>

                <div class="dashboard-section half">
                    <div class="section-header">
                        <h2>Alertas</h2>
                        <a href="/alerts" class="view-all">Ver todos</a>
                    </div>
                    <div class="alerts-list">
                        @foreach (var alert in financialAlerts)
                        {
                            <div class="alert-item @alert.SeverityClass">
                                <div class="alert-icon"></div>
                                <div class="alert-details">
                                    <h4>@alert.Title</h4>
                                    <p>@alert.Description</p>
                                    <span class="alert-date">@alert.Date.ToString("dd/MM/yyyy HH:mm")</span>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            
            <!-- Recent Transactions -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2>Movimentos Recentes</h2>
                    <a href="/transactions" class="view-all">Ver todos</a>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Ativo</th>
                                <th>Tipo</th>
                                <th>Descrição</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var transaction in recentTransactions)
                            {
                                <tr>
                                    <td>@transaction.Date.ToString("dd/MM/yyyy")</td>
                                    <td>@transaction.Asset</td>
                                    <td><span class="transaction-type @transaction.TypeClass">@transaction.Type</span></td>
                                    <td>@transaction.Description</td>
                                    <td>@transaction.Value.ToString("C2")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private string userName = "João Silva";
    private string userInitials => string.Join("", userName.Split(' ').Select(n => n[0]));
    private bool showUserMenu = false;

    private List<AssetAllocationModel> assetAllocation = new List<AssetAllocationModel>
    {
        new AssetAllocationModel { Class = "Depósitos a Prazo", Value = 114030.00M, Allocation = 35.0M, Target = 30.0M, Return = 2.5M, Status = "Sobrealoc.", StatusClass = "overallocated" },
        new AssetAllocationModel { Class = "Fundos de Investimento", Value = 130320.00M, Allocation = 40.0M, Target = 45.0M, Return = 7.8M, Status = "Subaloc.", StatusClass = "underallocated" },
        new AssetAllocationModel { Class = "Imóveis Arrendados", Value = 81450.00M, Allocation = 25.0M, Target = 25.0M, Return = 4.9M, Status = "Balanceado", StatusClass = "balanced" }
    };

    private List<PaymentModel> upcomingPayments = new List<PaymentModel>
    {
        new PaymentModel { AssetName = "Depósito a Prazo Millennium", Date = DateTime.Now.AddDays(5), Value = 87.50M, Description = "Juros Mensais", Type = "Depósito" },
        new PaymentModel { AssetName = "Fundo PPR Reforma Segura", Date = DateTime.Now.AddDays(8), Value = 262.50M, Description = "Rendimento", Type = "Fundo" },
        new PaymentModel { AssetName = "Apartamento T2 Braga", Date = DateTime.Now.AddDays(2), Value = 650.00M, Description = "Renda Mensal", Type = "Imóvel" },
        new PaymentModel { AssetName = "Loja Comercial Porto", Date = DateTime.Now.AddDays(12), Value = 320.00M, Description = "Renda Mensal", Type = "Imóvel" }
    };

    private List<AlertModel> financialAlerts = new List<AlertModel>
    {
        new AlertModel { Title = "Taxa Euribor Alterada", Description = "A taxa Euribor a 12 meses aumentou para 4.2% - considere renegociar os seus depósitos", Date = DateTime.Now.AddHours(-12), SeverityClass = "info" },
        new AlertModel { Title = "Renovação de Depósito", Description = "O Depósito a Prazo Santander vence em 7 dias. Preparar para renovação ou redirecionamento.", Date = DateTime.Now.AddDays(-1), SeverityClass = "warning" }
    };

    private List<TransactionModel> recentTransactions = new List<TransactionModel>
    {
        new TransactionModel { Date = DateTime.Now.AddDays(-2), Asset = "Apartamento T2 Braga", Type = "Recebimento", TypeClass = "buy", Description = "Renda de Maio", Value = 650.00M },
        new TransactionModel { Date = DateTime.Now.AddDays(-5), Asset = "Fundo PPR Reforma Segura", Type = "Investimento", TypeClass = "buy", Description = "Reforço mensal", Value = 250.00M },
        new TransactionModel { Date = DateTime.Now.AddDays(-8), Asset = "Depósito a Prazo Millennium", Type = "Recebimento", TypeClass = "buy", Description = "Juros Abril", Value = 87.50M },
        new TransactionModel { Date = DateTime.Now.AddDays(-15), Asset = "Loja Comercial Porto", Type = "Despesa", TypeClass = "sell", Description = "Manutenção", Value = -125.00M }
    };

    private void ToggleUserMenu()
    {
        showUserMenu = !showUserMenu;
    }

    private void Logout()
    {
        // Implementar lógica de logout
        NavigationManager.NavigateTo("/login");
    }

    public class AssetAllocationModel
    {
        public string Class { get; set; } = string.Empty;
        public decimal Value { get; set; }
        public decimal Allocation { get; set; }
        public decimal Target { get; set; }
        public decimal Return { get; set; }
        public string Status { get; set; } = string.Empty;
        public string StatusClass { get; set; } = string.Empty;
    }

    public class PaymentModel
    {
        public string AssetName { get; set; } = string.Empty;
        public DateTime Date { get; set; }
        public decimal Value { get; set; }
        public string Description { get; set; } = string.Empty;
        public string Type { get; set; } = string.Empty;
    }

    public class AlertModel
    {
        public string Title { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
        public DateTime Date { get; set; }
        public string SeverityClass { get; set; } = string.Empty;
    }

    public class TransactionModel
    {
        public DateTime Date { get; set; }
        public string Asset { get; set; } = string.Empty;
        public string Type { get; set; } = string.Empty;
        public string TypeClass { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
        public decimal Value { get; set; }
    }
}